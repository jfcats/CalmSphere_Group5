<div class="page-container">
  
  <div class="header-section">
    <div class="title-box">
      <h1>Agenda de Citas</h1>
      <p>Gestiona tus próximas sesiones y el historial.</p>
    </div>
    
    <button mat-flat-button class="btn-primary" routerLink="news">
      <mat-icon>add</mat-icon> Nueva Cita
    </button>
  </div>

  <!-- BARRA DE BÚSQUEDA -->
  <div class="search-bar">
    <mat-icon>search</mat-icon>
    <input type="text" placeholder="Buscar por motivo, profesional o paciente..." [(ngModel)]="filtroTexto" (keyup)="filtrar()">
  </div>

  <!-- GRID DE CITAS -->
  <div class="cards-grid">
    
    <div class="appointment-card" *ngFor="let e of eventosFiltrados">
      
      <!-- CABECERA DE TARJETA -->
      <div class="card-header">
        <div class="avatar-circle bg-purple">
          {{ getInitials(e.nombreProfesional || 'Profesional') }}
        </div>
        <div class="header-info">
          <h3>{{ e.nombreProfesional || 'Profesional Desconocido' }}</h3>
          <span class="role-label">Profesional</span>
        </div>
        
        <button mat-icon-button [matMenuTriggerFor]="menu">
            <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu #menu="matMenu">
            <button mat-menu-item [routerLink]="['edits', e.idEvento]">
                <mat-icon>edit</mat-icon> Editar
            </button>
            <button mat-menu-item (click)="eliminar(e.idEvento)">
                <mat-icon color="warn">cancel</mat-icon> Cancelar
            </button>
        </mat-menu>
      </div>

      <!-- CUERPO -->
      <div class="card-body">
        <div class="info-row">
            <mat-icon>person</mat-icon>
            <span><strong>Paciente:</strong> {{ e.nombreUsuario || 'Sin nombre' }}</span>
        </div>
        <div class="info-row">
            <mat-icon>event</mat-icon>
            <span>{{ e.inicio | date:'dd MMM yyyy' }}</span>
        </div>
        <div class="info-row">
            <mat-icon>schedule</mat-icon>
            <span>{{ e.inicio | date:'HH:mm' }} - {{ e.fin | date:'HH:mm' }}</span>
        </div>
        <div class="info-row highlight">
            <mat-icon>payments</mat-icon>
            <span>S/ {{ e.monto }} ({{ e.nombreMetodoPago }})</span>
        </div>
        
        <div class="motivo-box">
            <small>Motivo:</small>
            <p>{{ e.motivo }}</p>
        </div>
      </div>

      <!-- FOOTER / ESTADO -->
      <div class="card-footer">
        <span class="status-badge" [ngClass]="e.estado ? 'status-active' : 'status-inactive'">
            {{ e.estado ? 'Confirmada' : 'Cancelada/Inactiva' }}
        </span>
      </div>

    </div>

  </div>
  
  <!-- Estado vacío -->
  <div class="empty-state" *ngIf="eventosFiltrados.length === 0">
    <mat-icon>event_busy</mat-icon>
    <p>No se encontraron citas.</p>
  </div>

</div>